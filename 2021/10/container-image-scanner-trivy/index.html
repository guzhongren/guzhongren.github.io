<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Container Image Scanner - Trivy - 谷中仁的博客</title><meta name=Description content="Container Image Scanner"><meta property="og:title" content="Container Image Scanner - Trivy"><meta property="og:description" content="Container Image Scanner"><meta property="og:type" content="article"><meta property="og:url" content="https://guzhongren.github.io/2021/10/container-image-scanner-trivy/"><meta property="og:image" content="https://guzhongren.github.io"><meta property="article:published_time" content="2021-10-11T21:09:25+08:00"><meta property="article:modified_time" content="2022-02-26T15:35:47+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://guzhongren.github.io"><meta name=twitter:title content="Container Image Scanner - Trivy"><meta name=twitter:description content="Container Image Scanner"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/><link rel=prev href=https://guzhongren.github.io/2021/09/container-image-scanner-trivy/><link rel=next href=https://guzhongren.github.io/2021/10/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-accept-encoding/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Container Image Scanner - Trivy","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/guzhongren.github.io\/2021\/10\/container-image-scanner-trivy\/"},"genre":"posts","keywords":"Trivy, DevOps, Pipeline","wordcount":1671,"url":"https:\/\/guzhongren.github.io\/2021\/10\/container-image-scanner-trivy\/","datePublished":"2021-10-11T21:09:25+08:00","dateModified":"2022-02-26T15:35:47+08:00","license":"Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"guzhongren"},"author":{"@type":"Person","name":"谷中仁"},"description":"Container Image Scanner"}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=谷中仁的博客><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/avatar.svg data-srcset="/images/avatar.svg, /images/avatar.svg 1.5x, /images/avatar.svg 2x" data-sizes=auto alt=/images/avatar.svg title=/images/avatar.svg>谷中仁的博客</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/geekmd/>GeekMd </a><a class=menu-item href=/slides/>Slides </a><a class=menu-item href="https://www.figma.com/file/7EzjLtMRXKcaJrGEmudLwC/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1?node-id=0%3A1" rel="noopener noreffer" target=_blank>知识图谱 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/guzhongren title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/2021/10/container-image-scanner-trivy/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=谷中仁的博客><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/avatar.svg data-srcset="/images/avatar.svg, /images/avatar.svg 1.5x, /images/avatar.svg 2x" data-sizes=auto alt=/images/avatar.svg title=/images/avatar.svg>谷中仁的博客</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>所有文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/geekmd/>GeekMd</a><a class=menu-item href=/slides/>Slides</a><a class=menu-item href="https://www.figma.com/file/7EzjLtMRXKcaJrGEmudLwC/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1?node-id=0%3A1" rel="noopener noreffer" target=_blank>知识图谱</a><a class=menu-item href=/about/>关于</a><a class=menu-item href=https://github.com/guzhongren title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/2021/10/container-image-scanner-trivy/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Container Image Scanner - Trivy</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://guzhongren.github.io title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>谷中仁</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/devops/><i class="far fa-folder fa-fw"></i>DevOps</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-10-11>2021-10-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1671 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png title="Container Image Scanner"></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#pain-points-on-application-environment-security>Pain points on application environment security</a></li><li><a href=#the-value-of-keeping-container-image-secure>The value of keeping container image secure</a><ul><li><a href=#protect-the-clients-property-and-reputation>Protect the client&rsquo;s property and reputation</a></li><li><a href=#build-our-respected-brand>Build our respected brand</a></li></ul></li><li><a href=#best-2-solutions-to-keep-container-images-secure>Best 2 solutions to keep container images secure</a><ul><li><a href=#solution-1-scan-the-image-at-a-regular-time-in-the-image-registry>Solution 1: Scan the image at a regular time in the image registry</a></li><li><a href=#solution-2-integrate-the-scanner-within-your-cicd-pipeline>Solution 2: Integrate the scanner within your CI/CD pipeline</a></li></ul></li><li><a href=#container-image-scanner-comparison>Container image scanner comparison</a></li><li><a href=#trivy-in-thoughtworks-technology-radar-volume-23>Trivy in Thoughtworks Technology radar volume 23</a></li><li><a href=#inner-working-of-trivy>Inner working of Trivy</a></li><li><a href=#how-to-use-trivy>How To Use Trivy</a><ul><li><a href=#pipeline>Pipeline</a></li><li><a href=#usage-of-trivy>Usage of Trivy</a></li><li><a href=#demo>Demo</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#refs>Refs</a></li><li><a href=#disclaimer>Disclaimer</a></li><li><a href=#赞助>赞助</a></li></ul></nav></div></div><div class=content id=content><h2 id=abstract>Abstract</h2><p>In modern software development, we leverage public images as base images to build up applications images quickly and deploy them into the production environment.</p><p>With more and more applications containerized, container security is also becoming more important. To use vulnerability scanners, we can bring forward the security feedback cycle which is traditionally done towards the end. This aligns closely with our belief that by adopting agile, we will be able to get faster feedback. This is what we are doing in order to achieve it.</p><h2 id=pain-points-on-application-environment-security>Pain points on application environment security</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png title="Pain points on application environment security"></p><p>Now, we use advanced technology to build up our application, like NodeJS, Java and so on, then store the code repository on git platforms like GitHub, Gitlab and so on. Code repository consists of our code and dependencies; For dependencies, we can use tools to ensure security like npm audit of NodeJS, and Dependabot of GitHub; And for our business code, there is another security tool to scan, like <a href=https://www.sonarqube.org/ target=_blank rel="noopener noreffer">SoneQube</a>.</p><p>So, for the dependencies and our business code, those things are under our control, we can ensure the application’s security and get fast feedback and build confidence by using all kinds of tools before we deploy our application into the production environment. As you know, the basic system environment which our application runs is out of our control. Let’s consider from the opposite side, if we can’t ensure the security of our application and its system environment, it will lead to unexpected problems, like hackers attack, leakage of user information, property loss, what&rsquo;s more, cause damage to the reputation of the company. So, it is important to ensure the security of our product.</p><h2 id=the-value-of-keeping-container-image-secure>The value of keeping container image secure</h2><h3 id=protect-the-clients-property-and-reputation>Protect the client&rsquo;s property and reputation</h3><p>We supply professional services for our client, so we must ensure every line of code is reliable and secure. Because code is property and reputation. For ourselves, just ensure the security of code, and the environment of application, the client can achieve the maximum benefit.</p><h3 id=build-our-respected-brand>Build our respected brand</h3><p>The work we do is to make our clients succeed. Only if our customers succeed, we can succeed. So, we did not only archive business value, but also protect the security of the product.</p><h2 id=best-2-solutions-to-keep-container-images-secure>Best 2 solutions to keep container images secure</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2050.1czb512thukg.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2050.1czb512thukg.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2050.1czb512thukg.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2050.1czb512thukg.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2050.1czb512thukg.png title="Best 2 solutions to keep container images secure"></p><h3 id=solution-1-scan-the-image-at-a-regular-time-in-the-image-registry>Solution 1: Scan the image at a regular time in the image registry</h3><p>In this way, we need to add a security scanner for the images&rsquo; registry. The scanner might be a cron job or an operable step that can be triggered by the operator.</p><p>It will be automatically triggered by a cron job when a special time. For example, docker hub scans their official registry at a special time, it will send an alert to the organizer when there are any vulnerabilities.</p><h3 id=solution-2-integrate-the-scanner-within-your-cicd-pipeline>Solution 2: Integrate the scanner within your CI/CD pipeline</h3><p>In another way, we can scan the image product in the pipeline, it is more simple and efficient. The pipeline will automatically execute the command that scans the image when we push code to the code repository. Because the pipeline scans the product mechanically for every time, so we can find any security problem and fix it in time.</p><p>Now, more and more teams or groups use agile to develop their projects. If we can find any vulnerabilities as early as possible, we can reduce the risk of the product before the product is published. The pipeline is a good tool to ensure the security of your product every line of code because it can automatically execute when you commit your code.</p><h2 id=container-image-scanner-comparison>Container image scanner comparison</h2><p>For the above solution, we surveyed several scanner tools, like <a href=https://github.com/aquasecurity/trivy target=_blank rel="noopener noreffer">Trivy</a>,<a href=https://github.com/quay/clair target=_blank rel="noopener noreffer">Claire</a>, <a href=https://github.com/anchore/anchore-engine target=_blank rel="noopener noreffer">Anchore Engine</a>, <a href=https://github.com/quay/quay target=_blank rel="noopener noreffer">Quay</a>,<a href=https://hub.docker.com/ target=_blank rel="noopener noreffer">Docker Hub</a> and <a href=https://cloud.google.com/container-registry target=_blank rel="noopener noreffer">GCR</a>. We made a comparison from different dimensions.</p><table><thead><tr><th align=left>Scanner</th><th align=left>OS packages</th><th align=left>Application dependencies</th><th align=left>Easy to use</th><th align=left>Accuracy</th><th align=left>Suitable for CI</th><th align=left>Suitable for Solution</th></tr></thead><tbody><tr><td align=left>Trivy</td><td align=left>✅</td><td align=left>✅</td><td align=left>⭐ ⭐ ⭐</td><td align=left>⭐ ⭐ ⭐</td><td align=left>⭐ ⭐ ⭐</td><td align=left>2</td></tr><tr><td align=left>Clair</td><td align=left>✅</td><td align=left>❌</td><td align=left>⭐</td><td align=left>⭐ ⭐</td><td align=left>⭐ ⭐</td><td align=left>2</td></tr><tr><td align=left>Anchore Engine</td><td align=left>✅</td><td align=left>✅</td><td align=left>⭐ ⭐</td><td align=left>⭐ ⭐</td><td align=left>⭐ ⭐ ⭐</td><td align=left>2</td></tr><tr><td align=left>Quay</td><td align=left>✅</td><td align=left>❌</td><td align=left>⭐ ⭐ ⭐</td><td align=left>⭐ ⭐</td><td align=left>❌</td><td align=left>1</td></tr><tr><td align=left>Docker Hub</td><td align=left>✅</td><td align=left>❌</td><td align=left>⭐⭐⭐</td><td align=left>⭐</td><td align=left>❌</td><td align=left>1</td></tr><tr><td align=left>GCR</td><td align=left>✅</td><td align=left>❌</td><td align=left>⭐ ⭐ ⭐</td><td align=left>⭐ ⭐</td><td align=left>❌</td><td align=left>1</td></tr></tbody></table><p>Firstly we can separate those scanners into 2 parts suitable for solution, the Trivy, Clair, Anchore Engine, and Quay are suitable for solution, the others are suitable for solution 1.</p><p>For the first dimension: OS package, those scanners can do it, but for the second dimension: Application dependence, just only Trivy and Anchore engine can do it, and for the fifth dimension is it suitable for ci; only the first three left.</p><p>For the Trivy, Clair, and Anchore Engine, the communities of these three are very active, so we could not care about anyone to solve your issues; And as a tool, it must be easy to use and there is good documentation to reference. The documentation of Trivy is very detailed and very friendly. But for the vulnerability database, Clair ingests vulnerability metadata at regular intervals from a configured set of sources and stores the data in its database. Trivy and Anchore Engine will download the latest vulnerability metadata and cache it in a local file,
it will check the update to keep the metadata latest when the tool runs again. At the same time, the usage of Trivy is more friendly, because we can filter the different severity which you can specify, but it is not allowed for Anchore Engine.</p><p>March 16, 2020, Aqua Security, the leading platform provider for securing cloud-native applications and infrastructure, announced today that its open-source Trivy vulnerability scanner is being added as an integrated option in widely used cloud-native platforms, CNCF’s Harbor registry and Mirantis Docker Enterprise. You can find this post <a href=https://blog.aquasec.com/trivy-vulnerability-scanner-joins-aqua-family target=_blank rel="noopener noreffer">here</a>.</p><h2 id=trivy-in-thoughtworks-technology-radar-volume-23>Trivy in Thoughtworks Technology radar volume 23</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-tw-radar.2543ysqo6wf4.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-tw-radar.2543ysqo6wf4.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-tw-radar.2543ysqo6wf4.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-tw-radar.2543ysqo6wf4.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-tw-radar.2543ysqo6wf4.png title="Trivy in TW tech radar"></p><p>Thoughtworks Technology Radar is famous for accurately responding to technological trends; In the latest technology radar, Thoughtworks put the Trivy into the <strong>adopt</strong> area, which means Trivy is useful, valuable and practicable.</p><h2 id=inner-working-of-trivy>Inner working of Trivy</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2051.4icjkydqu3s0.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2051.4icjkydqu3s0.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2051.4icjkydqu3s0.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2051.4icjkydqu3s0.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2051.4icjkydqu3s0.png title="Inner working of Trivy"></p><p>Before we use Trivy, we need to know how Trivy works inside. As you see, there are 2 steps; first, we run the Trivy command, Trivy will download the vulnerability DB from the <a href=https://nvd.nist.gov target=_blank rel="noopener noreffer">NVD</a> website into the local machine. And then Trivy uses the vulnerability data to scan every layer of your image.</p><h2 id=how-to-use-trivy>How To Use Trivy</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-in-pipeline.6ksfsma323c0.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-in-pipeline.6ksfsma323c0.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-in-pipeline.6ksfsma323c0.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-in-pipeline.6ksfsma323c0.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-in-pipeline.6ksfsma323c0.png title="trivy in pipeline"></p><h3 id=pipeline>Pipeline</h3><p>Now we have to know how Trivy works inside, we can integrate it into our pipeline; you can see this pipeline, first, we build code into docker image, next, Trivy will check the vulnerabilities in the docker image that build from the last step; if there is no vulnerability, the image will be pushed to the image registry and deploy it to the production environment. If there are some vulnerabilities, the pipeline will be broken by the Trivy command line, you need to fix the vulnerability to make the pipeline green.</p><h3 id=usage-of-trivy>Usage of Trivy</h3><p>Before we write code to integrate, we have to know how to use Trivy. As we know, Trivy is a binary application, so we can use it in the command line. At the same time, Trivy provides its docker image, so we can easily setup it and use it, the command is as follows. For this command, we need to highlight some parameters.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-shell data-lang=shell>❯ docker run --rm <span class=se>\
</span><span class=se></span>  -v /var/run/docker.sock:/var/run/docker.sock <span class=se>\
</span><span class=se></span>  aquasec/trivy <span class=se>\
</span><span class=se></span>  image <span class=se>\
</span><span class=se></span>  --exit-code <span class=m>1</span> <span class=se>\
</span><span class=se></span>  --ignore-unfixed <span class=se>\
</span><span class=se></span>  --severity HIGH,CRITICAL <span class=si>${</span><span class=nv>YOUR_IMAGE</span><span class=si>}</span>
</code></pre></td></tr></table></div></div><ul><li>-v /var/run/docker.sock:/var/run/docker.sock If you would like to scan the image on your local host machine, you need to mount docker.sock</li><li>&ndash;ignore-unfixed Ignore the unfixed issue of vulnerability; If there are some unfixed vulnerabilities, trivy will ignore those vulnerabilities</li><li>&ndash;severity Set the vulnerability level which you want to scan</li><li>&ndash;exit-code Status of trivy when vulnerabilities were found (default: 0). In the pipeline if you set the value to 1, the pipeline will exit and not run continually if you set it to 0, the pipeline will continually run but report the result. So, if you wanna break the pipeline, you can set it to 1.</li></ul><p>For more information about the arguments and other usages with different ways, please visit the website of Trivy organization by this link: <a href=https://github.com/aquasecurity/trivy target=_blank rel="noopener noreffer">https://github.com/aquasecurity/trivy</a>.</p><h3 id=demo>Demo</h3><p>Below is a demo to show how the trivy breaks the pipeline and what happens when we fix the issues; This project is about to build a Buildkite dashboard, it will filter the built information of your organization which you specify. We use Github actions to build application and setup the Trivy in the pipeline;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yml data-lang=yml>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Trivy<span class=w> </span>scanner<span class=w>
</span><span class=w>  </span><span class=k>run</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>     </span><span class=sd> </span><span class=sd>docker run --rm \</span><span class=w>
</span><span class=w>      </span>-v<span class=w> </span>/var/run/docker.sock<span class=p>:</span>/var/run/docker.sock<span class=w> </span>\<span class=w>
</span><span class=w>      </span>aquasec/trivy<span class=w> </span>image<span class=w> </span>\<span class=w>
</span><span class=w>      </span>--severity<span class=w> </span>HIGH<span class=p>,</span>CRITICAL<span class=w> </span>\<span class=w>
</span><span class=w>      </span>--exit-code<span class=w> </span><span class=m>1</span><span class=w> </span>\<span class=w>
</span><span class=w>      </span>dashboard<span class=p>:</span>${{<span class=w> </span>github.sha<span class=w> </span>}}<span class=w>
</span></code></pre></td></tr></table></div></div><p>In this build job, we use <a href=https://hub.docker.com/_/nginx target=_blank rel="noopener noreffer">Nignx:1.18</a> as a base image to build application images. This build failed because there are some vulnerabilities.</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-failed.4bffhau2xvk0.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-failed.4bffhau2xvk0.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-failed.4bffhau2xvk0.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-failed.4bffhau2xvk0.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-failed.4bffhau2xvk0.png title="Trivy Dashboard Failed"></p><p>Now, we must fix this issue to continue delivery. There are 2 steps to do, firstly, we should use the latest Nginx image as a base image; secondly, we could ignore unfixed vulnerabilities, because maybe we are unable to fix vulnerabilities at the system level. You can review the change of code by clicking this link:
<a href=https://github.com/guzhongren/Buildkite-Dashboard/commit/90182b9b3770aeb28a6e566208334dd0c6f8f725#annotation_843974303 target=_blank rel="noopener noreffer">https://github.com/guzhongren/Buildkite-Dashboard/commit/90182b9b3770aeb28a6e566208334dd0c6f8f725#annotation_843974303</a></p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-successfully.28w37b5otts0.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-successfully.28w37b5otts0.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-successfully.28w37b5otts0.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-successfully.28w37b5otts0.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/trivy-dashboard-successfully.28w37b5otts0.png title="Trivy Dashboard Successfully"></p><h2 id=summary>Summary</h2><p>Security is a very important issue no matter where you are. We can <strong>Shift Left Security</strong>, so we can reduce the security risk in the production environment; For the scanner tool Trivy, it is very useful to keep the security of images, it can scan not only images but also git repositories, file systems, etc.</p><h2 id=refs>Refs</h2><ul><li><a href=https://www.sonarqube.org/ target=_blank rel="noopener noreffer">https://www.sonarqube.org/</a></li><li><a href=https://hub.docker.com/r/aquasec/trivy#ignore-unfixed-vulnerabilities target=_blank rel="noopener noreffer">https://hub.docker.com/r/aquasec/trivy#ignore-unfixed-vulnerabilities</a></li><li><a href=https://github.com/marketplace/actions/aqua-security-trivy target=_blank rel="noopener noreffer">https://github.com/marketplace/actions/aqua-security-trivy</a></li><li><a href=https://github.com/quay/clair target=_blank rel="noopener noreffer">https://github.com/quay/clair</a></li><li><a href=https://github.com/aquasecurity/trivy target=_blank rel="noopener noreffer">https://github.com/aquasecurity/trivy</a></li><li><a href=https://github.com/anchore/anchore-engine target=_blank rel="noopener noreffer">https://github.com/anchore/anchore-engine</a></li><li><a href=https://github.com/quay/quay target=_blank rel="noopener noreffer">https://github.com/quay/quay</a></li><li><a href=https://cloud.google.com/container-registry target=_blank rel="noopener noreffer">https://cloud.google.com/container-registry</a></li><li><a href=https://goharbor.io/blog/harbor-1.10-release/ target=_blank rel="noopener noreffer">https://goharbor.io/blog/harbor-1.10-release/</a></li><li><a href="https://www.thoughtworks.com/radar/tools?blipid=201911077" target=_blank rel="noopener noreffer">https://www.thoughtworks.com/radar/tools?blipid=201911077</a></li><li><a href=https://cve.mitre.org/index.html target=_blank rel="noopener noreffer">https://cve.mitre.org/index.html</a>
<a href=https://nvd.nist.gov target=_blank rel="noopener noreffer">https://nvd.nist.gov</a></li><li><a href=https://blog.aquasec.com/trivy-vulnerability-scanner-joins-aqua-family target=_blank rel="noopener noreffer">https://blog.aquasec.com/trivy-vulnerability-scanner-joins-aqua-family</a></li><li><a href=https://guzhongren.github.io/ target=_blank rel="noopener noreffer">https://guzhongren.github.io/</a></li></ul><h2 id=disclaimer>Disclaimer</h2><p>本文仅代表个人观点，与<a href=https://www.Thoughtworks.com/ target=_blank rel="noopener noreffer">Thoughtworks</a> 公司无任何关系。</p><hr><p><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/%e6%89%ab%e7%a0%81_%e6%90%9c%e7%b4%a2%e8%81%94%e5%90%88%e4%bc%a0%e6%92%ad%e6%a0%b7%e5%bc%8f-%e7%99%bd%e8%89%b2%e7%89%88.ae9zxgscqcg.png data-srcset="https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/%e6%89%ab%e7%a0%81_%e6%90%9c%e7%b4%a2%e8%81%94%e5%90%88%e4%bc%a0%e6%92%ad%e6%a0%b7%e5%bc%8f-%e7%99%bd%e8%89%b2%e7%89%88.ae9zxgscqcg.png, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/%e6%89%ab%e7%a0%81_%e6%90%9c%e7%b4%a2%e8%81%94%e5%90%88%e4%bc%a0%e6%92%ad%e6%a0%b7%e5%bc%8f-%e7%99%bd%e8%89%b2%e7%89%88.ae9zxgscqcg.png 1.5x, https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/%e6%89%ab%e7%a0%81_%e6%90%9c%e7%b4%a2%e8%81%94%e5%90%88%e4%bc%a0%e6%92%ad%e6%a0%b7%e5%bc%8f-%e7%99%bd%e8%89%b2%e7%89%88.ae9zxgscqcg.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/扫码_搜索联合传播样式-白色版.ae9zxgscqcg.png title=谷哥说-微信公众号></p><blockquote><p><a href=https://emn178.github.io/online-tools/sha256_checksum.html target=_blank rel="noopener noreffer">SHA256</a> checksum: f2fe1394e4ab9297ed69ff73ac32e9ac1375f01c2102183b509bf9379a5995d6</p></blockquote><h2 id=赞助>赞助</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/pay/PayForGuzhongren.svg data-srcset="/images/pay/PayForGuzhongren.svg, /images/pay/PayForGuzhongren.svg 1.5x, /images/pay/PayForGuzhongren.svg 2x" data-sizes=auto alt=/images/pay/PayForGuzhongren.svg title=PayForGuzhongren></p><blockquote><p><a href=https://emn178.github.io/online-tools/sha256_checksum.html target=_blank rel="noopener noreffer">SHA256</a> checksum: 964978ecd2059064abe542e51dc02e204d3ee2e6c320ca68e2b1399ce0c6953c</p></blockquote><blockquote><p>使用此<a href=https://guzhongren.github.io/images/pay/payforguzhongren.svg.sig target=_blank rel="noopener noreffer">文件</a>进行校验： <code>gpg --verify PayForGuzhongren.svg.sig</code></p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-02-26&nbsp;<a class=git-hash href=https://github.com/guzhongren/guzhongren.github.io/commit/c8dfb34b0eaebbf3441b3234e5376dd13587f1ad target=_blank title="commit by guzhongren(guzhongren@live.cn) c8dfb34b0eaebbf3441b3234e5376dd13587f1ad: fix(Disclaimer): Update 免责声明 to Disclaimer">
<i class="fas fa-hashtag fa-fw"></i>c8dfb34</a></span></div><div class=post-info-license><span><a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/80x15.png></a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-title="Container Image Scanner - Trivy" data-hashtags=Trivy,DevOps,Pipeline><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-hashtag=Trivy><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 WhatsApp" data-sharer=whatsapp data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-title="Container Image Scanner - Trivy" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-title="Container Image Scanner - Trivy"><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-title="Container Image Scanner - Trivy" data-image=https://cdn.jsdelivr.net/gh/guzhongren/data-hosting@main/20210819/Group%2052.5gp1z5ybbps0.png><i class="fab fa-weibo fa-fw"></i></a><a href=javascript:void(0); title="分享到 Myspace" data-sharer=myspace data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-title="Container Image Scanner - Trivy" data-description="Container Image Scanner"><i data-svg-src=/lib/simple-icons/icons/myspace.min.svg></i></a><a href=javascript:void(0); title="分享到 Blogger" data-sharer=blogger data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-title="Container Image Scanner - Trivy" data-description="Container Image Scanner"><i class="fab fa-blogger fa-fw"></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://guzhongren.github.io/2021/10/container-image-scanner-trivy/ data-title="Container Image Scanner - Trivy"><i class="fab fa-evernote fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/trivy/>Trivy</a>,&nbsp;<a href=/tags/devops/>DevOps</a>,&nbsp;<a href=/tags/pipeline/>Pipeline</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2021/09/container-image-scanner-trivy/ class=prev rel=prev title="Container Image Scanner - Trivy"><i class="fas fa-angle-left fa-fw"></i>Container Image Scanner - Trivy</a>
<a href=/2021/10/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96-accept-encoding/ class=next rel=next title="性能优化 Accept-Encoding">性能优化 Accept-Encoding<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>友情链接:<div style=display:flex;justify-content:center;align-items:center><a style="display:flex;justify-content:center;align-items:center;margin:0 1rem" href=https://yihaimen.github.io><span style=display:flex;justify-content:center;align-items:center><img style=height:24px src=https://yihaimen.github.io/images/avatar.png><span>易海门的博客</span></span></a><a style="display:flex;justify-content:center;align-items:center;margin:0 1rem" href=https://bytewars.cc><span style=display:flex;justify-content:center;align-items:center><img style=height:24px src=https://bytewars.github.io/images/avatar.png><span>ByteWars社区</span></span></a></div></div><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.64.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://guzhongren.github.io/ target=_blank>谷中仁</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"title","label":"utterances","lightTheme":"github-light","repo":"guzhongren/guzhongren.github.io"}},"search":{"algoliaAppID":"8FBSWQTAD1","algoliaIndex":"index.zh-cn","algoliaSearchKey":"f8e94db6f14a6320dcdcb4db3f7256aa","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','UA-158950474-1',{'anonymize_ip':true});</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-158950474-1" async></script></body></html>